rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {//0 @ /root/...
      allow read, write: if false;
    }

    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    function incrementsByOne(field) {
      let logTitle = debug("** FieldValue Increment **");
      return debug(request.resource.data[field]) == debug(resource.data[field] + 1);
    }

    match /users/{userId} {//1 @ /root/users/
      allow get: if isOwner(userId);

      match /parentExercises/{_tally} {
        allow create, update: if incrementsByOne("parentExercise_count");
      }
      match /parentExercises/{docId} {//2 @ /root/users/parentExercises
        allow create: if isOwner(userId);

    //     match /exerciseSessions/{docId} {//3 @ /root/users/parentExercises/exerciseSessions

    //     }
      }

    //   match /workouts/{docId} {//2 @ /root/users/workouts


    //     match /childExercises/{docId} {//3 @ /root/users/workouts/childExercises

    //     }
    //   }

    //   match /workoutSessions/{docId} {//2 @ /root/users/workoutSessions

    //   }
    }
  }
}
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {//0 @ /root/...
      allow read, write: if false;
    }

    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    function incrementsByOne(field) {
      let logTitle = debug("** FieldValue Increment **");
      return debug(request.resource.data[field]) == debug(resource.data[field] + 1);
    }
    function notTallyDoc(docId) {
      let logTitle = debug("** Current Document Id **");
      return debug(docId) != "_tally";
    }

    match /users/{userId} {//L1 @ /root/users/
      allow get: if isOwner(userId);

      match /parentExercises/{_tally} {//L2 @ /root/users/parentExercises/_tally
        allow create, update: if incrementsByOne("parentExercise_count");
      }
      match /parentExercises/{parentExerciseId} {//L2 @ /root/users/parentExercises
        allow create, list: if isOwner(userId);
        allow update: if isOwner(userId) && notTallyDoc(parentExerciseId);

    //     match /exerciseSessions/{docId} {//L3 @ /root/users/parentExercises/exerciseSessions

    //     }
      }

    //   match /workouts/{docId} {//L2 @ /root/users/workouts


    //     match /childExercises/{docId} {//L3 @ /root/users/workouts/childExercises

    //     }
    //   }

    //   match /workoutSessions/{docId} {//L2 @ /root/users/workoutSessions

    //   }
    }
  }
}